{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _objectSpread from\"F:/mern/udemy/ecommerce/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"F:/mern/udemy/ecommerce/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{useSelector,useDispatch}from\"react-redux\";import{toast}from\"react-toastify\";import{getUserCart,emptyUserCart,saveUserAddress,applyCoupon}from\"../functions/user\";import ReactQuill from\"react-quill\";import\"react-quill/dist/quill.snow.css\";var Checkout=function Checkout(_ref){var history=_ref.history;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),products=_useState2[0],setProducts=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),total=_useState4[0],setTotal=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),address=_useState6[0],setAddress=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),addressSaved=_useState8[0],setAddressSaved=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),coupon=_useState10[0],setCoupon=_useState10[1];// discount price\nvar _useState11=useState(0),_useState12=_slicedToArray(_useState11,2),totalAfterDiscount=_useState12[0],setTotalAfterDiscount=_useState12[1];var _useState13=useState(\"\"),_useState14=_slicedToArray(_useState13,2),discountError=_useState14[0],setDiscountError=_useState14[1];var dispatch=useDispatch();var _useSelector=useSelector(function(state){return _objectSpread({},state);}),user=_useSelector.user;useEffect(function(){getUserCart(user.token).then(function(res){console.log(\"user cart res\",JSON.stringify(res.data,null,4));setProducts(res.data.products);setTotal(res.data.cartTotal);});},[]);var emptyCart=function emptyCart(){// remove from local storage\nif(typeof window!==\"undefined\"){localStorage.removeItem(\"cart\");}// remove from redux\ndispatch({type:\"ADD_TO_CART\",payload:[]});// remove from backend\nemptyUserCart(user.token).then(function(res){setProducts([]);setTotal(0);setTotalAfterDiscount(0);setCoupon(\"\");toast.success(\"Cart is emapty. Contniue shopping.\");});};var saveAddressToDb=function saveAddressToDb(){// console.log(address);\nsaveUserAddress(user.token,address).then(function(res){if(res.data.ok){setAddressSaved(true);toast.success(\"Address saved\");}});};var applyDiscountCoupon=function applyDiscountCoupon(){console.log(\"send coupon to backend\",coupon);applyCoupon(user.token,coupon).then(function(res){console.log(\"RES ON COUPON APPLIED\",res.data);if(res.data){setTotalAfterDiscount(res.data);// update redux coupon applied true/false\ndispatch({type:\"COUPON_APPLIED\",payload:true});}// error\nif(res.data.err){setDiscountError(res.data.err);// update redux coupon applied true/false\ndispatch({type:\"COUPON_APPLIED\",payload:false});}});};var showAddress=function showAddress(){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ReactQuill,{theme:\"snow\",value:address,onChange:setAddress}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary mt-2\",onClick:saveAddressToDb,children:\"Save\"})]});};var showProductSummary=function showProductSummary(){return products.map(function(p,i){return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"p\",{children:[p.product.title,\" (\",p.color,\") x \",p.count,\" =\",\" \",p.product.price*p.count]})},i);});};var showApplyCoupon=function showApplyCoupon(){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"input\",{onChange:function onChange(e){setCoupon(e.target.value);setDiscountError(\"\");},value:coupon,type:\"text\",className:\"form-control\"}),/*#__PURE__*/_jsx(\"button\",{onClick:applyDiscountCoupon,className:\"btn btn-primary mt-2\",children:\"Apply\"})]});};return/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Delivery Address\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),showAddress(),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"h4\",{children:\"Got Coupon?\"}),/*#__PURE__*/_jsx(\"br\",{}),showApplyCoupon(),/*#__PURE__*/_jsx(\"br\",{}),discountError&&/*#__PURE__*/_jsx(\"p\",{className:\"bg-danger p-2\",children:discountError})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Order Summary\"}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Products \",products.length]}),/*#__PURE__*/_jsx(\"hr\",{}),showProductSummary(),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Cart Total: \",total]}),totalAfterDiscount>0&&/*#__PURE__*/_jsxs(\"p\",{className:\"bg-success p-2\",children:[\"Discount Applied: Total Payable: $\",totalAfterDiscount]}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-md-6\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",disabled:!addressSaved||!products.length,onClick:function onClick(){return history.push(\"/payment\");},children:\"Place Order\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-6\",children:/*#__PURE__*/_jsx(\"button\",{disabled:!products.length,onClick:emptyCart,className:\"btn btn-primary\",children:\"Empty Cart\"})})]})]})]});};export default Checkout;","map":{"version":3,"sources":["F:/mern/udemy/ecommerce/client/src/pages/Checkout.js"],"names":["React","useEffect","useState","useSelector","useDispatch","toast","getUserCart","emptyUserCart","saveUserAddress","applyCoupon","ReactQuill","Checkout","history","products","setProducts","total","setTotal","address","setAddress","addressSaved","setAddressSaved","coupon","setCoupon","totalAfterDiscount","setTotalAfterDiscount","discountError","setDiscountError","dispatch","state","user","token","then","res","console","log","JSON","stringify","data","cartTotal","emptyCart","window","localStorage","removeItem","type","payload","success","saveAddressToDb","ok","applyDiscountCoupon","err","showAddress","showProductSummary","map","p","i","product","title","color","count","price","showApplyCoupon","e","target","value","length","push"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { toast } from \"react-toastify\";\nimport {\n  getUserCart,\n  emptyUserCart,\n  saveUserAddress,\n  applyCoupon,\n} from \"../functions/user\";\nimport ReactQuill from \"react-quill\";\nimport \"react-quill/dist/quill.snow.css\";\n\nconst Checkout = ({ history }) => {\n  const [products, setProducts] = useState([]);\n  const [total, setTotal] = useState(0);\n  const [address, setAddress] = useState(\"\");\n  const [addressSaved, setAddressSaved] = useState(false);\n  const [coupon, setCoupon] = useState(\"\");\n  // discount price\n  const [totalAfterDiscount, setTotalAfterDiscount] = useState(0);\n  const [discountError, setDiscountError] = useState(\"\");\n\n  const dispatch = useDispatch();\n  const { user } = useSelector((state) => ({ ...state }));\n\n  useEffect(() => {\n    getUserCart(user.token).then((res) => {\n      console.log(\"user cart res\", JSON.stringify(res.data, null, 4));\n      setProducts(res.data.products);\n      setTotal(res.data.cartTotal);\n    });\n  }, []);\n\n  const emptyCart = () => {\n    // remove from local storage\n    if (typeof window !== \"undefined\") {\n      localStorage.removeItem(\"cart\");\n    }\n    // remove from redux\n    dispatch({\n      type: \"ADD_TO_CART\",\n      payload: [],\n    });\n    // remove from backend\n    emptyUserCart(user.token).then((res) => {\n      setProducts([]);\n      setTotal(0);\n      setTotalAfterDiscount(0);\n      setCoupon(\"\");\n      toast.success(\"Cart is emapty. Contniue shopping.\");\n    });\n  };\n\n  const saveAddressToDb = () => {\n    // console.log(address);\n    saveUserAddress(user.token, address).then((res) => {\n      if (res.data.ok) {\n        setAddressSaved(true);\n        toast.success(\"Address saved\");\n      }\n    });\n  };\n\n  const applyDiscountCoupon = () => {\n    console.log(\"send coupon to backend\", coupon);\n    applyCoupon(user.token, coupon).then((res) => {\n      console.log(\"RES ON COUPON APPLIED\", res.data);\n      if (res.data) {\n        setTotalAfterDiscount(res.data);\n        // update redux coupon applied true/false\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: true,\n        });\n      }\n      // error\n      if (res.data.err) {\n        setDiscountError(res.data.err);\n        // update redux coupon applied true/false\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: false,\n        });\n      }\n    });\n  };\n\n  const showAddress = () => (\n    <>\n      <ReactQuill theme=\"snow\" value={address} onChange={setAddress} />\n      <button className=\"btn btn-primary mt-2\" onClick={saveAddressToDb}>\n        Save\n      </button>\n    </>\n  );\n\n  const showProductSummary = () =>\n    products.map((p, i) => (\n      <div key={i}>\n        <p>\n          {p.product.title} ({p.color}) x {p.count} ={\" \"}\n          {p.product.price * p.count}\n        </p>\n      </div>\n    ));\n\n  const showApplyCoupon = () => (\n    <>\n      <input\n        onChange={(e) => {\n          setCoupon(e.target.value);\n          setDiscountError(\"\");\n        }}\n        value={coupon}\n        type=\"text\"\n        className=\"form-control\"\n      />\n      <button onClick={applyDiscountCoupon} className=\"btn btn-primary mt-2\">\n        Apply\n      </button>\n    </>\n  );\n\n  return (\n    <div className=\"row\">\n      <div className=\"col-md-6\">\n        <h4>Delivery Address</h4>\n        <br />\n        <br />\n        {showAddress()}\n        <hr />\n        <h4>Got Coupon?</h4>\n        <br />\n        {showApplyCoupon()}\n        <br />\n        {discountError && <p className=\"bg-danger p-2\">{discountError}</p>}\n      </div>\n\n      <div className=\"col-md-6\">\n        <h4>Order Summary</h4>\n        <hr />\n        <p>Products {products.length}</p>\n        <hr />\n        {showProductSummary()}\n        <hr />\n        <p>Cart Total: {total}</p>\n\n        {totalAfterDiscount > 0 && (\n          <p className=\"bg-success p-2\">\n            Discount Applied: Total Payable: ${totalAfterDiscount}\n          </p>\n        )}\n\n        <div className=\"row\">\n          <div className=\"col-md-6\">\n            <button\n              className=\"btn btn-primary\"\n              disabled={!addressSaved || !products.length}\n              onClick={() => history.push(\"/payment\")}\n            >\n              Place Order\n            </button>\n          </div>\n\n          <div className=\"col-md-6\">\n            <button\n              disabled={!products.length}\n              onClick={emptyCart}\n              className=\"btn btn-primary\"\n            >\n              Empty Cart\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Checkout;\n"]},"metadata":{},"sourceType":"module"}