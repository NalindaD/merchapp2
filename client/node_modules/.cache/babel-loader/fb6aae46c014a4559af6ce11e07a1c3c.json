{"ast":null,"code":"import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _objectSpread from\"F:/mern/udemy/ecommerce/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React from\"react\";import Resizer from\"react-image-file-resizer\";import axios from\"axios\";import{useSelector}from\"react-redux\";import{Avatar,Badge}from\"antd\";var FileUpload=function FileUpload(_ref){var values=_ref.values,setValues=_ref.setValues,setLoading=_ref.setLoading;var _useSelector=useSelector(function(state){return _objectSpread({},state);}),user=_useSelector.user;var fileUploadAndResize=function fileUploadAndResize(e){// console.log(e.target.files);\n// resize\nvar files=e.target.files;// 3\nvar allUploadedFiles=values.images;if(files){setLoading(true);for(var i=0;i<files.length;i++){Resizer.imageFileResizer(files[i],720,720,\"JPEG\",100,0,function(uri){// console.log(uri);\naxios.post(\"\".concat(process.env.REACT_APP_API,\"/uploadimages\"),{image:uri},{headers:{authtoken:user?user.token:\"\"}}).then(function(res){console.log(\"IMAGE UPLOAD RES DATA\",res);setLoading(false);allUploadedFiles.push(res.data);setValues(_objectSpread(_objectSpread({},values),{},{images:allUploadedFiles}));}).catch(function(err){setLoading(false);console.log(\"CLOUDINARY UPLOAD ERR\",err);});},\"base64\");}}// send back to server to upload to cloudinary\n// set url to images[] in the parent component state - ProductCreate\n};var handleImageRemove=function handleImageRemove(public_id){setLoading(true);// console.log(\"remove image\", public_id);\naxios.post(\"\".concat(process.env.REACT_APP_API,\"/removeimage\"),{public_id:public_id},{headers:{authtoken:user?user.token:\"\"}}).then(function(res){setLoading(false);var images=values.images;var filteredImages=images.filter(function(item){return item.public_id!==public_id;});setValues(_objectSpread(_objectSpread({},values),{},{images:filteredImages}));}).catch(function(err){console.log(err);setLoading(false);});};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:values.images&&values.images.map(function(image){return/*#__PURE__*/_jsx(Badge,{count:\"X\",onClick:function onClick(){return handleImageRemove(image.public_id);},style:{cursor:\"pointer\"},children:/*#__PURE__*/_jsx(Avatar,{src:image.url,size:100,shape:\"square\",className:\"ml-3\"})},image.public_id);})}),/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsxs(\"label\",{className:\"btn btn-primary btn-raised mt-3\",children:[\"Choose File\",/*#__PURE__*/_jsx(\"input\",{type:\"file\",multiple:true,hidden:true,accept:\"images/*\",onChange:fileUploadAndResize})]})})]});};export default FileUpload;","map":{"version":3,"sources":["F:/mern/udemy/ecommerce/client/src/components/forms/FileUpload.js"],"names":["React","Resizer","axios","useSelector","Avatar","Badge","FileUpload","values","setValues","setLoading","state","user","fileUploadAndResize","e","files","target","allUploadedFiles","images","i","length","imageFileResizer","uri","post","process","env","REACT_APP_API","image","headers","authtoken","token","then","res","console","log","push","data","catch","err","handleImageRemove","public_id","filteredImages","filter","item","map","cursor","url"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport Resizer from \"react-image-file-resizer\";\nimport axios from \"axios\";\nimport { useSelector } from \"react-redux\";\nimport { Avatar, Badge } from \"antd\";\n\nconst FileUpload = ({ values, setValues, setLoading }) => {\n  const { user } = useSelector((state) => ({ ...state }));\n\n  const fileUploadAndResize = (e) => {\n    // console.log(e.target.files);\n    // resize\n    let files = e.target.files; // 3\n    let allUploadedFiles = values.images;\n\n    if (files) {\n      setLoading(true);\n      for (let i = 0; i < files.length; i++) {\n        Resizer.imageFileResizer(\n          files[i],\n          720,\n          720,\n          \"JPEG\",\n          100,\n          0,\n          (uri) => {\n            // console.log(uri);\n            axios\n              .post(\n                `${process.env.REACT_APP_API}/uploadimages`,\n                { image: uri },\n                {\n                  headers: {\n                    authtoken: user ? user.token : \"\",\n                  },\n                }\n              )\n              .then((res) => {\n                console.log(\"IMAGE UPLOAD RES DATA\", res);\n                setLoading(false);\n                allUploadedFiles.push(res.data);\n\n                setValues({ ...values, images: allUploadedFiles });\n              })\n              .catch((err) => {\n                setLoading(false);\n                console.log(\"CLOUDINARY UPLOAD ERR\", err);\n              });\n          },\n          \"base64\"\n        );\n      }\n    }\n    // send back to server to upload to cloudinary\n    // set url to images[] in the parent component state - ProductCreate\n  };\n\n  const handleImageRemove = (public_id) => {\n    setLoading(true);\n    // console.log(\"remove image\", public_id);\n    axios\n      .post(\n        `${process.env.REACT_APP_API}/removeimage`,\n        { public_id },\n        {\n          headers: {\n            authtoken: user ? user.token : \"\",\n          },\n        }\n      )\n      .then((res) => {\n        setLoading(false);\n        const { images } = values;\n        let filteredImages = images.filter((item) => {\n          return item.public_id !== public_id;\n        });\n        setValues({ ...values, images: filteredImages });\n      })\n      .catch((err) => {\n        console.log(err);\n        setLoading(false);\n      });\n  };\n\n  return (\n    <>\n      <div className=\"row\">\n        {values.images &&\n          values.images.map((image) => (\n            <Badge\n              count=\"X\"\n              key={image.public_id}\n              onClick={() => handleImageRemove(image.public_id)}\n              style={{ cursor: \"pointer\" }}\n            >\n              <Avatar\n                src={image.url}\n                size={100}\n                shape=\"square\"\n                className=\"ml-3\"\n              />\n            </Badge>\n          ))}\n      </div>\n      <div className=\"row\">\n        <label className=\"btn btn-primary btn-raised mt-3\">\n          Choose File\n          <input\n            type=\"file\"\n            multiple\n            hidden\n            accept=\"images/*\"\n            onChange={fileUploadAndResize}\n          />\n        </label>\n      </div>\n    </>\n  );\n};\n\nexport default FileUpload;\n"]},"metadata":{},"sourceType":"module"}