{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _regeneratorRuntime from\"F:/mern/udemy/ecommerce/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"F:/mern/udemy/ecommerce/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"F:/mern/udemy/ecommerce/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{auth}from\"../../firebase\";import{toast}from\"react-toastify\";import{useDispatch}from\"react-redux\";import{createOrUpdateUser}from\"../../functions/auth\";var RegisterComplete=function RegisterComplete(_ref){var history=_ref.history;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),email=_useState2[0],setEmail=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),password=_useState4[0],setPassword=_useState4[1];// const { user } = useSelector((state) => ({ ...state }));\nvar dispatch=useDispatch();useEffect(function(){setEmail(window.localStorage.getItem(\"emailForRegistration\"));// console.log(window.location.href);\n// console.log(window.localStorage.getItem(\"emailForRegistration\"));\n},[history]);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var result,user,idTokenResult;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();// validation\nif(!(!email||!password)){_context.next=4;break;}toast.error(\"Email and password is required\");return _context.abrupt(\"return\");case 4:if(!(password.length<6)){_context.next=7;break;}toast.error(\"Password must be at least 6 characters long\");return _context.abrupt(\"return\");case 7:_context.prev=7;_context.next=10;return auth.signInWithEmailLink(email,window.location.href);case 10:result=_context.sent;if(!result.user.emailVerified){_context.next=22;break;}// remove user email fom local storage\nwindow.localStorage.removeItem(\"emailForRegistration\");// get user id token\nuser=auth.currentUser;_context.next=16;return user.updatePassword(password);case 16:_context.next=18;return user.getIdTokenResult();case 18:idTokenResult=_context.sent;// redux store\nconsole.log(\"user\",user,\"idTokenResult\",idTokenResult);createOrUpdateUser(idTokenResult.token).then(function(res){dispatch({type:\"LOGGED_IN_USER\",payload:{name:res.data.name,email:res.data.email,token:idTokenResult.token,role:res.data.role,_id:res.data._id}});}).catch(function(err){return console.log(err);});// redirect\nhistory.push(\"/\");case 22:_context.next=28;break;case 24:_context.prev=24;_context.t0=_context[\"catch\"](7);console.log(_context.t0);toast.error(_context.t0.message);case 28:case\"end\":return _context.stop();}}},_callee,null,[[7,24]]);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();var completeRegistrationForm=function completeRegistrationForm(){return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"input\",{type:\"email\",className:\"form-control\",value:email,disabled:true}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",className:\"form-control\",value:password,onChange:function onChange(e){return setPassword(e.target.value);},placeholder:\"Password\",autoFocus:true}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-raised\",children:\"Complete Registration\"})]});};return/*#__PURE__*/_jsx(\"div\",{className:\"container p-5\",children:/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6 offset-md-3\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Register Complete\"}),completeRegistrationForm()]})})});};export default RegisterComplete;","map":{"version":3,"sources":["F:/mern/udemy/ecommerce/client/src/pages/auth/RegisterComplete.js"],"names":["React","useState","useEffect","auth","toast","useDispatch","createOrUpdateUser","RegisterComplete","history","email","setEmail","password","setPassword","dispatch","window","localStorage","getItem","handleSubmit","e","preventDefault","error","length","signInWithEmailLink","location","href","result","user","emailVerified","removeItem","currentUser","updatePassword","getIdTokenResult","idTokenResult","console","log","token","then","res","type","payload","name","data","role","_id","catch","err","push","message","completeRegistrationForm","target","value"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { auth } from \"../../firebase\";\nimport { toast } from \"react-toastify\";\nimport { useDispatch } from \"react-redux\";\nimport { createOrUpdateUser } from \"../../functions/auth\";\n\nconst RegisterComplete = ({ history }) => {\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n\n  // const { user } = useSelector((state) => ({ ...state }));\n  let dispatch = useDispatch();\n\n  useEffect(() => {\n    setEmail(window.localStorage.getItem(\"emailForRegistration\"));\n    // console.log(window.location.href);\n    // console.log(window.localStorage.getItem(\"emailForRegistration\"));\n  }, [history]);\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    // validation\n    if (!email || !password) {\n      toast.error(\"Email and password is required\");\n      return;\n    }\n\n    if (password.length < 6) {\n      toast.error(\"Password must be at least 6 characters long\");\n      return;\n    }\n\n    try {\n      const result = await auth.signInWithEmailLink(\n        email,\n        window.location.href\n      );\n      //   console.log(\"RESULT\", result);\n      if (result.user.emailVerified) {\n        // remove user email fom local storage\n        window.localStorage.removeItem(\"emailForRegistration\");\n        // get user id token\n        let user = auth.currentUser;\n        await user.updatePassword(password);\n        const idTokenResult = await user.getIdTokenResult();\n        // redux store\n        console.log(\"user\", user, \"idTokenResult\", idTokenResult);\n\n        createOrUpdateUser(idTokenResult.token)\n          .then((res) => {\n            dispatch({\n              type: \"LOGGED_IN_USER\",\n              payload: {\n                name: res.data.name,\n                email: res.data.email,\n                token: idTokenResult.token,\n                role: res.data.role,\n                _id: res.data._id,\n              },\n            });\n          })\n          .catch((err) => console.log(err));\n\n        // redirect\n        history.push(\"/\");\n      }\n    } catch (error) {\n      console.log(error);\n      toast.error(error.message);\n    }\n  };\n\n  const completeRegistrationForm = () => (\n    <form onSubmit={handleSubmit}>\n      <input type=\"email\" className=\"form-control\" value={email} disabled />\n\n      <input\n        type=\"password\"\n        className=\"form-control\"\n        value={password}\n        onChange={(e) => setPassword(e.target.value)}\n        placeholder=\"Password\"\n        autoFocus\n      />\n      <br />\n      <button type=\"submit\" className=\"btn btn-raised\">\n        Complete Registration\n      </button>\n    </form>\n  );\n\n  return (\n    <div className=\"container p-5\">\n      <div className=\"row\">\n        <div className=\"col-md-6 offset-md-3\">\n          <h4>Register Complete</h4>\n          {completeRegistrationForm()}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default RegisterComplete;\n"]},"metadata":{},"sourceType":"module"}