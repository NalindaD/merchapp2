{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"F:\\\\mern\\\\udemy\\\\ecommerce\\\\client\\\\src\\\\pages\\\\Checkout.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { toast } from \"react-toastify\";\nimport { getUserCart, emptyUserCart, saveUserAddress, applyCoupon } from \"../functions/user\";\nimport ReactQuill from \"react-quill\";\nimport \"react-quill/dist/quill.snow.css\";\n\nconst Checkout = ({\n  history\n}) => {\n  _s();\n\n  const [products, setProducts] = useState([]);\n  const [total, setTotal] = useState(0);\n  const [address, setAddress] = useState(\"\");\n  const [addressSaved, setAddressSaved] = useState(false);\n  const [coupon, setCoupon] = useState(\"\"); // discount price\n\n  const [totalAfterDiscount, setTotalAfterDiscount] = useState(0);\n  const [discountError, setDiscountError] = useState(\"\");\n  const dispatch = useDispatch();\n  const {\n    user\n  } = useSelector(state => ({ ...state\n  }));\n  useEffect(() => {\n    getUserCart(user.token).then(res => {\n      console.log(\"user cart res\", JSON.stringify(res.data, null, 4));\n      setProducts(res.data.products);\n      setTotal(res.data.cartTotal);\n    });\n  }, []);\n\n  const emptyCart = () => {\n    // remove from local storage\n    if (typeof window !== \"undefined\") {\n      localStorage.removeItem(\"cart\");\n    } // remove from redux\n\n\n    dispatch({\n      type: \"ADD_TO_CART\",\n      payload: []\n    }); // remove from backend\n\n    emptyUserCart(user.token).then(res => {\n      setProducts([]);\n      setTotal(0);\n      setTotalAfterDiscount(0);\n      setCoupon(\"\");\n      toast.success(\"Cart is emapty. Contniue shopping.\");\n    });\n  };\n\n  const saveAddressToDb = () => {\n    // console.log(address);\n    saveUserAddress(user.token, address).then(res => {\n      if (res.data.ok) {\n        setAddressSaved(true);\n        toast.success(\"Address saved\");\n      }\n    });\n  };\n\n  const applyDiscountCoupon = () => {\n    console.log(\"send coupon to backend\", coupon);\n    applyCoupon(user.token, coupon).then(res => {\n      console.log(\"RES ON COUPON APPLIED\", res.data);\n\n      if (res.data) {\n        setTotalAfterDiscount(res.data); // update redux coupon applied true/false\n\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: true\n        });\n      } // error\n\n\n      if (res.data.err) {\n        setDiscountError(res.data.err); // update redux coupon applied true/false\n\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: false\n        });\n      }\n    });\n  };\n\n  const showAddress = () => /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(ReactQuill, {\n      theme: \"snow\",\n      value: address,\n      onChange: setAddress\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn btn-primary mt-2\",\n      onClick: saveAddressToDb,\n      children: \"Save\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n\n  const showProductSummary = () => products.map((p, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [p.product.title, \" (\", p.color, \") x \", p.count, \" =\", \" \", p.product.price * p.count]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 9\n    }, this)\n  }, i, false, {\n    fileName: _jsxFileName,\n    lineNumber: 99,\n    columnNumber: 7\n  }, this));\n\n  const showApplyCoupon = () => /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"input\", {\n      onChange: e => {\n        setCoupon(e.target.value);\n        setDiscountError(\"\");\n      },\n      value: coupon,\n      type: \"text\",\n      className: \"form-control\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: applyDiscountCoupon,\n      className: \"btn btn-primary mt-2\",\n      children: \"Apply\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"row\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"col-md-6\",\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"Delivery Address\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 9\n      }, this), showAddress(), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"Got Coupon?\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 9\n      }, this), showApplyCoupon(), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 9\n      }, this), discountError && /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"bg-danger p-2\",\n        children: discountError\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 27\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"col-md-6\",\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"Order Summary\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [\"Products \", products.length]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 9\n      }, this), showProductSummary(), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [\"Cart Total: \", total]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 9\n      }, this), totalAfterDiscount > 0 && /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"bg-success p-2\",\n        children: [\"Discount Applied: Total Payable: $\", totalAfterDiscount]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col-md-6\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn btn-primary\",\n            disabled: !addressSaved || !products.length,\n            onClick: () => history.push(\"/payment\"),\n            children: \"Place Order\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 156,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col-md-6\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            disabled: !products.length,\n            onClick: emptyCart,\n            className: \"btn btn-primary\",\n            children: \"Empty Cart\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 166,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 125,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Checkout, \"Vj38Ax2om1Il4FiK1s3g3kldxNI=\", false, function () {\n  return [useDispatch, useSelector];\n});\n\n_c = Checkout;\nexport default Checkout;\n\nvar _c;\n\n$RefreshReg$(_c, \"Checkout\");","map":{"version":3,"sources":["F:/mern/udemy/ecommerce/client/src/pages/Checkout.js"],"names":["React","useEffect","useState","useSelector","useDispatch","toast","getUserCart","emptyUserCart","saveUserAddress","applyCoupon","ReactQuill","Checkout","history","products","setProducts","total","setTotal","address","setAddress","addressSaved","setAddressSaved","coupon","setCoupon","totalAfterDiscount","setTotalAfterDiscount","discountError","setDiscountError","dispatch","user","state","token","then","res","console","log","JSON","stringify","data","cartTotal","emptyCart","window","localStorage","removeItem","type","payload","success","saveAddressToDb","ok","applyDiscountCoupon","err","showAddress","showProductSummary","map","p","i","product","title","color","count","price","showApplyCoupon","e","target","value","length","push"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { toast } from \"react-toastify\";\nimport {\n  getUserCart,\n  emptyUserCart,\n  saveUserAddress,\n  applyCoupon,\n} from \"../functions/user\";\nimport ReactQuill from \"react-quill\";\nimport \"react-quill/dist/quill.snow.css\";\n\nconst Checkout = ({ history }) => {\n  const [products, setProducts] = useState([]);\n  const [total, setTotal] = useState(0);\n  const [address, setAddress] = useState(\"\");\n  const [addressSaved, setAddressSaved] = useState(false);\n  const [coupon, setCoupon] = useState(\"\");\n  // discount price\n  const [totalAfterDiscount, setTotalAfterDiscount] = useState(0);\n  const [discountError, setDiscountError] = useState(\"\");\n\n  const dispatch = useDispatch();\n  const { user } = useSelector((state) => ({ ...state }));\n\n  useEffect(() => {\n    getUserCart(user.token).then((res) => {\n      console.log(\"user cart res\", JSON.stringify(res.data, null, 4));\n      setProducts(res.data.products);\n      setTotal(res.data.cartTotal);\n    });\n  }, []);\n\n  const emptyCart = () => {\n    // remove from local storage\n    if (typeof window !== \"undefined\") {\n      localStorage.removeItem(\"cart\");\n    }\n    // remove from redux\n    dispatch({\n      type: \"ADD_TO_CART\",\n      payload: [],\n    });\n    // remove from backend\n    emptyUserCart(user.token).then((res) => {\n      setProducts([]);\n      setTotal(0);\n      setTotalAfterDiscount(0);\n      setCoupon(\"\");\n      toast.success(\"Cart is emapty. Contniue shopping.\");\n    });\n  };\n\n  const saveAddressToDb = () => {\n    // console.log(address);\n    saveUserAddress(user.token, address).then((res) => {\n      if (res.data.ok) {\n        setAddressSaved(true);\n        toast.success(\"Address saved\");\n      }\n    });\n  };\n\n  const applyDiscountCoupon = () => {\n    console.log(\"send coupon to backend\", coupon);\n    applyCoupon(user.token, coupon).then((res) => {\n      console.log(\"RES ON COUPON APPLIED\", res.data);\n      if (res.data) {\n        setTotalAfterDiscount(res.data);\n        // update redux coupon applied true/false\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: true,\n        });\n      }\n      // error\n      if (res.data.err) {\n        setDiscountError(res.data.err);\n        // update redux coupon applied true/false\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: false,\n        });\n      }\n    });\n  };\n\n  const showAddress = () => (\n    <>\n      <ReactQuill theme=\"snow\" value={address} onChange={setAddress} />\n      <button className=\"btn btn-primary mt-2\" onClick={saveAddressToDb}>\n        Save\n      </button>\n    </>\n  );\n\n  const showProductSummary = () =>\n    products.map((p, i) => (\n      <div key={i}>\n        <p>\n          {p.product.title} ({p.color}) x {p.count} ={\" \"}\n          {p.product.price * p.count}\n        </p>\n      </div>\n    ));\n\n  const showApplyCoupon = () => (\n    <>\n      <input\n        onChange={(e) => {\n          setCoupon(e.target.value);\n          setDiscountError(\"\");\n        }}\n        value={coupon}\n        type=\"text\"\n        className=\"form-control\"\n      />\n      <button onClick={applyDiscountCoupon} className=\"btn btn-primary mt-2\">\n        Apply\n      </button>\n    </>\n  );\n\n  return (\n    <div className=\"row\">\n      <div className=\"col-md-6\">\n        <h4>Delivery Address</h4>\n        <br />\n        <br />\n        {showAddress()}\n        <hr />\n        <h4>Got Coupon?</h4>\n        <br />\n        {showApplyCoupon()}\n        <br />\n        {discountError && <p className=\"bg-danger p-2\">{discountError}</p>}\n      </div>\n\n      <div className=\"col-md-6\">\n        <h4>Order Summary</h4>\n        <hr />\n        <p>Products {products.length}</p>\n        <hr />\n        {showProductSummary()}\n        <hr />\n        <p>Cart Total: {total}</p>\n\n        {totalAfterDiscount > 0 && (\n          <p className=\"bg-success p-2\">\n            Discount Applied: Total Payable: ${totalAfterDiscount}\n          </p>\n        )}\n\n        <div className=\"row\">\n          <div className=\"col-md-6\">\n            <button\n              className=\"btn btn-primary\"\n              disabled={!addressSaved || !products.length}\n              onClick={() => history.push(\"/payment\")}\n            >\n              Place Order\n            </button>\n          </div>\n\n          <div className=\"col-md-6\">\n            <button\n              disabled={!products.length}\n              onClick={emptyCart}\n              className=\"btn btn-primary\"\n            >\n              Empty Cart\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Checkout;\n"]},"metadata":{},"sourceType":"module"}