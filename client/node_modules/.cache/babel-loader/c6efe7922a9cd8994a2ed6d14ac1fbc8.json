{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _defineProperty from\"F:/mern/udemy/ecommerce/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"F:/mern/udemy/ecommerce/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"F:/mern/udemy/ecommerce/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import AdminNav from\"../../../components/nav/AdminNav\";import{toast}from\"react-toastify\";import{useSelector}from\"react-redux\";import{getProduct,updateProduct}from\"../../../functions/product\";import{getCategories,getCategorySubs}from\"../../../functions/category\";import FileUpload from\"../../../components/forms/FileUpload\";import{LoadingOutlined}from\"@ant-design/icons\";import ProductUpdateForm from\"../../../components/forms/ProductUpdateForm\";var initialState={title:\"\",description:\"\",price:\"\",category:\"\",subs:[],shipping:\"\",quantity:\"\",images:[],colors:[\"Black\",\"Brown\",\"Silver\",\"White\",\"Blue\"],brands:[\"Apple\",\"Samsung\",\"Microsoft\",\"Lenovo\",\"ASUS\"],color:\"\",brand:\"\"};var ProductUpdate=function ProductUpdate(_ref){var match=_ref.match,history=_ref.history;// state\nvar _useState=useState(initialState),_useState2=_slicedToArray(_useState,2),values=_useState2[0],setValues=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),categories=_useState4[0],setCategories=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),subOptions=_useState6[0],setSubOptions=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),arrayOfSubs=_useState8[0],setArrayOfSubs=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),selectedCategory=_useState10[0],setSelectedCategory=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),loading=_useState12[0],setLoading=_useState12[1];var _useSelector=useSelector(function(state){return _objectSpread({},state);}),user=_useSelector.user;// router\nvar slug=match.params.slug;useEffect(function(){loadProduct();loadCategories();},[]);var loadProduct=function loadProduct(){getProduct(slug).then(function(p){// console.log(\"single product\", p);\n// 1 load single proudct\nsetValues(_objectSpread(_objectSpread({},values),p.data));// 2 load single product category subs\ngetCategorySubs(p.data.category._id).then(function(res){setSubOptions(res.data);// on first load, show default subs\n});// 3 prepare array of sub ids to show as default sub values in antd Select\nvar arr=[];p.data.subs.map(function(s){arr.push(s._id);});console.log(\"ARR\",arr);setArrayOfSubs(function(prev){return arr;});// required for ant design select to work\n});};var loadCategories=function loadCategories(){return getCategories().then(function(c){console.log(\"GET CATEGORIES IN UPDATE PRODUCT\",c.data);setCategories(c.data);});};var handleSubmit=function handleSubmit(e){e.preventDefault();setLoading(true);values.subs=arrayOfSubs;values.category=selectedCategory?selectedCategory:values.category;updateProduct(slug,values,user.token).then(function(res){setLoading(false);toast.success(\"\\\"\".concat(res.data.title,\"\\\" is updated\"));history.push(\"/admin/products\");}).catch(function(err){console.log(err);setLoading(false);toast.error(err.response.data.err);});};var handleChange=function handleChange(e){setValues(_objectSpread(_objectSpread({},values),{},_defineProperty({},e.target.name,e.target.value)));// console.log(e.target.name, \" ----- \", e.target.value);\n};var handleCategoryChange=function handleCategoryChange(e){e.preventDefault();console.log(\"CLICKED CATEGORY\",e.target.value);setValues(_objectSpread(_objectSpread({},values),{},{subs:[]}));setSelectedCategory(e.target.value);getCategorySubs(e.target.value).then(function(res){console.log(\"SUB OPTIONS ON CATGORY CLICK\",res);setSubOptions(res.data);});console.log(\"EXISTING CATEGORY values.category\",values.category);// if user clicks back to the original category\n// show its sub categories in default\nif(values.category._id===e.target.value){loadProduct();}// clear old sub category ids\nsetArrayOfSubs([]);};return/*#__PURE__*/_jsx(\"div\",{className:\"container-fluid\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-md-2\",children:/*#__PURE__*/_jsx(AdminNav,{})}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-10\",children:[loading?/*#__PURE__*/_jsx(LoadingOutlined,{className:\"text-danger h1\"}):/*#__PURE__*/_jsx(\"h4\",{children:\"Product update\"}),/*#__PURE__*/_jsx(\"div\",{className:\"p-3\",children:/*#__PURE__*/_jsx(FileUpload,{values:values,setValues:setValues,setLoading:setLoading})}),/*#__PURE__*/_jsx(ProductUpdateForm,{handleSubmit:handleSubmit,handleChange:handleChange,setValues:setValues,values:values,handleCategoryChange:handleCategoryChange,categories:categories,subOptions:subOptions,arrayOfSubs:arrayOfSubs,setArrayOfSubs:setArrayOfSubs,selectedCategory:selectedCategory}),/*#__PURE__*/_jsx(\"hr\",{})]})]})});};export default ProductUpdate;","map":{"version":3,"sources":["F:/mern/udemy/ecommerce/client/src/pages/admin/product/ProductUpdate.js"],"names":["React","useState","useEffect","AdminNav","toast","useSelector","getProduct","updateProduct","getCategories","getCategorySubs","FileUpload","LoadingOutlined","ProductUpdateForm","initialState","title","description","price","category","subs","shipping","quantity","images","colors","brands","color","brand","ProductUpdate","match","history","values","setValues","categories","setCategories","subOptions","setSubOptions","arrayOfSubs","setArrayOfSubs","selectedCategory","setSelectedCategory","loading","setLoading","state","user","slug","params","loadProduct","loadCategories","then","p","data","_id","res","arr","map","s","push","console","log","prev","c","handleSubmit","e","preventDefault","token","success","catch","err","error","response","handleChange","target","name","value","handleCategoryChange"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport AdminNav from \"../../../components/nav/AdminNav\";\nimport { toast } from \"react-toastify\";\nimport { useSelector } from \"react-redux\";\nimport { getProduct, updateProduct } from \"../../../functions/product\";\nimport { getCategories, getCategorySubs } from \"../../../functions/category\";\nimport FileUpload from \"../../../components/forms/FileUpload\";\nimport { LoadingOutlined } from \"@ant-design/icons\";\nimport ProductUpdateForm from \"../../../components/forms/ProductUpdateForm\";\n\nconst initialState = {\n  title: \"\",\n  description: \"\",\n  price: \"\",\n  category: \"\",\n  subs: [],\n  shipping: \"\",\n  quantity: \"\",\n  images: [],\n  colors: [\"Black\", \"Brown\", \"Silver\", \"White\", \"Blue\"],\n  brands: [\"Apple\", \"Samsung\", \"Microsoft\", \"Lenovo\", \"ASUS\"],\n  color: \"\",\n  brand: \"\",\n};\n\nconst ProductUpdate = ({ match, history }) => {\n  // state\n  const [values, setValues] = useState(initialState);\n  const [categories, setCategories] = useState([]);\n  const [subOptions, setSubOptions] = useState([]);\n  const [arrayOfSubs, setArrayOfSubs] = useState([]);\n  const [selectedCategory, setSelectedCategory] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n\n  const { user } = useSelector((state) => ({ ...state }));\n  // router\n  const { slug } = match.params;\n\n  useEffect(() => {\n    loadProduct();\n    loadCategories();\n  }, []);\n\n  const loadProduct = () => {\n    getProduct(slug).then((p) => {\n      // console.log(\"single product\", p);\n      // 1 load single proudct\n      setValues({ ...values, ...p.data });\n      // 2 load single product category subs\n      getCategorySubs(p.data.category._id).then((res) => {\n        setSubOptions(res.data); // on first load, show default subs\n      });\n      // 3 prepare array of sub ids to show as default sub values in antd Select\n      let arr = [];\n      p.data.subs.map((s) => {\n        arr.push(s._id);\n      });\n      console.log(\"ARR\", arr);\n      setArrayOfSubs((prev) => arr); // required for ant design select to work\n    });\n  };\n\n  const loadCategories = () =>\n    getCategories().then((c) => {\n      console.log(\"GET CATEGORIES IN UPDATE PRODUCT\", c.data);\n      setCategories(c.data);\n    });\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    setLoading(true);\n\n    values.subs = arrayOfSubs;\n    values.category = selectedCategory ? selectedCategory : values.category;\n\n    updateProduct(slug, values, user.token)\n      .then((res) => {\n        setLoading(false);\n        toast.success(`\"${res.data.title}\" is updated`);\n        history.push(\"/admin/products\");\n      })\n      .catch((err) => {\n        console.log(err);\n        setLoading(false);\n        toast.error(err.response.data.err);\n      });\n  };\n\n  const handleChange = (e) => {\n    setValues({ ...values, [e.target.name]: e.target.value });\n    // console.log(e.target.name, \" ----- \", e.target.value);\n  };\n\n  const handleCategoryChange = (e) => {\n    e.preventDefault();\n    console.log(\"CLICKED CATEGORY\", e.target.value);\n    setValues({ ...values, subs: [] });\n\n    setSelectedCategory(e.target.value);\n\n    getCategorySubs(e.target.value).then((res) => {\n      console.log(\"SUB OPTIONS ON CATGORY CLICK\", res);\n      setSubOptions(res.data);\n    });\n\n    console.log(\"EXISTING CATEGORY values.category\", values.category);\n\n    // if user clicks back to the original category\n    // show its sub categories in default\n    if (values.category._id === e.target.value) {\n      loadProduct();\n    }\n    // clear old sub category ids\n    setArrayOfSubs([]);\n  };\n\n  return (\n    <div className=\"container-fluid\">\n      <div className=\"row\">\n        <div className=\"col-md-2\">\n          <AdminNav />\n        </div>\n\n        <div className=\"col-md-10\">\n          {loading ? (\n            <LoadingOutlined className=\"text-danger h1\" />\n          ) : (\n            <h4>Product update</h4>\n          )}\n\n          {/* {JSON.stringify(values)} */}\n\n          <div className=\"p-3\">\n            <FileUpload\n              values={values}\n              setValues={setValues}\n              setLoading={setLoading}\n            />\n          </div>\n\n          <ProductUpdateForm\n            handleSubmit={handleSubmit}\n            handleChange={handleChange}\n            setValues={setValues}\n            values={values}\n            handleCategoryChange={handleCategoryChange}\n            categories={categories}\n            subOptions={subOptions}\n            arrayOfSubs={arrayOfSubs}\n            setArrayOfSubs={setArrayOfSubs}\n            selectedCategory={selectedCategory}\n          />\n          <hr />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ProductUpdate;\n"]},"metadata":{},"sourceType":"module"}