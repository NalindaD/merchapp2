{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _regeneratorRuntime from\"F:/mern/udemy/ecommerce/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"F:/mern/udemy/ecommerce/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"F:/mern/udemy/ecommerce/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"F:/mern/udemy/ecommerce/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{auth,googleAuthProvider}from\"../../firebase\";import{toast}from\"react-toastify\";import{Button}from\"antd\";import{MailOutlined,GoogleOutlined}from\"@ant-design/icons\";import{useDispatch,useSelector}from\"react-redux\";import{Link}from\"react-router-dom\";import{createOrUpdateUser}from\"../../functions/auth\";var Login=function Login(_ref){var history=_ref.history;var _useState=useState(\"n.dissanayaka424@gmail.com\"),_useState2=_slicedToArray(_useState,2),email=_useState2[0],setEmail=_useState2[1];var _useState3=useState(\"123456\"),_useState4=_slicedToArray(_useState3,2),password=_useState4[0],setPassword=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var _useSelector=useSelector(function(state){return _objectSpread({},state);}),user=_useSelector.user;useEffect(function(){var intended=history.location.state;if(intended){return;}else{if(user&&user.token)history.push(\"/\");}},[user,history]);var dispatch=useDispatch();var roleBasedRedirect=function roleBasedRedirect(res){// check if intended\nvar intended=history.location.state;if(intended){history.push(intended.from);}else{if(res.data.role===\"admin\"){history.push(\"/admin/dashboard\");}else if(res.data.role===\"seller\"){history.push(\"/seller/dashboard\");}else{history.push(\"/user/history\");}}};var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var result,_user,idTokenResult;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();setLoading(true);// console.table(email, password);\n_context.prev=2;_context.next=5;return auth.signInWithEmailAndPassword(email,password);case 5:result=_context.sent;// console.log(result);\n_user=result.user;_context.next=9;return _user.getIdTokenResult();case 9:idTokenResult=_context.sent;createOrUpdateUser(idTokenResult.token).then(function(res){dispatch({type:\"LOGGED_IN_USER\",payload:{name:res.data.name,email:res.data.email,token:idTokenResult.token,role:res.data.role,_id:res.data._id}});roleBasedRedirect(res);}).catch(function(err){return console.log(err);});// history.push(\"/\");\n_context.next=18;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](2);console.log(_context.t0);toast.error(_context.t0.message);setLoading(false);case 18:case\"end\":return _context.stop();}}},_callee,null,[[2,13]]);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();var googleLogin=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:auth.signInWithPopup(googleAuthProvider).then(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(result){var user,idTokenResult;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:user=result.user;_context2.next=3;return user.getIdTokenResult();case 3:idTokenResult=_context2.sent;createOrUpdateUser(idTokenResult.token).then(function(res){dispatch({type:\"LOGGED_IN_USER\",payload:{name:res.data.name,email:res.data.email,token:idTokenResult.token,role:res.data.role,_id:res.data._id}});roleBasedRedirect(res);}).catch(function(err){return console.log(err);});// history.push(\"/\");\ncase 5:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref4.apply(this,arguments);};}()).catch(function(err){console.log(err);toast.error(err.message);});case 1:case\"end\":return _context3.stop();}}},_callee3);}));return function googleLogin(){return _ref3.apply(this,arguments);};}();var loginForm=function loginForm(){return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsx(\"input\",{type:\"email\",className:\"form-control\",value:email,onChange:function onChange(e){return setEmail(e.target.value);},placeholder:\"Your email\",autoFocus:true})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsx(\"input\",{type:\"password\",className:\"form-control\",value:password,onChange:function onChange(e){return setPassword(e.target.value);},placeholder:\"Your password\"})}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Button,{onClick:handleSubmit,type:\"primary\",className:\"mb-3\",block:true,shape:\"round\",icon:/*#__PURE__*/_jsx(MailOutlined,{}),size:\"large\",disabled:!email||password.length<6,children:\"Login with Email/Password\"})]});};return/*#__PURE__*/_jsx(\"div\",{className:\"container p-5\",children:/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6 offset-md-3\",children:[loading?/*#__PURE__*/_jsx(\"h4\",{className:\"text-danger\",children:\"Loading...\"}):/*#__PURE__*/_jsx(\"h4\",{children:\"Login\"}),loginForm(),/*#__PURE__*/_jsx(Button,{onClick:googleLogin,type:\"danger\",className:\"mb-3\",block:true,shape:\"round\",icon:/*#__PURE__*/_jsx(GoogleOutlined,{}),size:\"large\",children:\"Login with Google\"}),/*#__PURE__*/_jsx(Link,{to:\"/forgot/password\",className:\"float-right text-danger\",children:\"Forgot Password\"})]})})});};export default Login;","map":{"version":3,"sources":["F:/mern/udemy/ecommerce/client/src/pages/auth/Login.js"],"names":["React","useState","useEffect","auth","googleAuthProvider","toast","Button","MailOutlined","GoogleOutlined","useDispatch","useSelector","Link","createOrUpdateUser","Login","history","email","setEmail","password","setPassword","loading","setLoading","state","user","intended","location","token","push","dispatch","roleBasedRedirect","res","from","data","role","handleSubmit","e","preventDefault","signInWithEmailAndPassword","result","getIdTokenResult","idTokenResult","then","type","payload","name","_id","catch","err","console","log","error","message","googleLogin","signInWithPopup","loginForm","target","value","length"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { auth, googleAuthProvider } from \"../../firebase\";\nimport { toast } from \"react-toastify\";\nimport { Button } from \"antd\";\nimport { MailOutlined, GoogleOutlined } from \"@ant-design/icons\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Link } from \"react-router-dom\";\nimport { createOrUpdateUser } from \"../../functions/auth\";\n\nconst Login = ({ history }) => {\n  const [email, setEmail] = useState(\"n.dissanayaka424@gmail.com\");\n  const [password, setPassword] = useState(\"123456\");\n  const [loading, setLoading] = useState(false);\n\n  const { user } = useSelector((state) => ({ ...state }));\n\n  useEffect(() => {\n    let intended = history.location.state;\n    if (intended) {\n      return;\n    } else {\n      if (user && user.token) history.push(\"/\");\n    }\n  }, [user, history]);\n\n  let dispatch = useDispatch();\n\n  const roleBasedRedirect = (res) => {\n    // check if intended\n    let intended = history.location.state;\n    if (intended) {\n      history.push(intended.from);\n    } else {\n      if (res.data.role === \"admin\") {\n        history.push(\"/admin/dashboard\");\n      }else if(res.data.role === \"seller\"){\n        history.push(\"/seller/dashboard\");\n      } else {\n        history.push(\"/user/history\");\n      }\n    }\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setLoading(true);\n    // console.table(email, password);\n    try {\n      const result = await auth.signInWithEmailAndPassword(email, password);\n      // console.log(result);\n      const { user } = result;\n      const idTokenResult = await user.getIdTokenResult();\n\n      createOrUpdateUser(idTokenResult.token)\n        .then((res) => {\n          dispatch({\n            type: \"LOGGED_IN_USER\",\n            payload: {\n              name: res.data.name,\n              email: res.data.email,\n              token: idTokenResult.token,\n              role: res.data.role,\n              _id: res.data._id,\n            },\n          });\n          roleBasedRedirect(res);\n        })\n        .catch((err) => console.log(err));\n\n      // history.push(\"/\");\n    } catch (error) {\n      console.log(error);\n      toast.error(error.message);\n      setLoading(false);\n    }\n  };\n\n  const googleLogin = async () => {\n    auth\n      .signInWithPopup(googleAuthProvider)\n      .then(async (result) => {\n        const { user } = result;\n        const idTokenResult = await user.getIdTokenResult();\n        createOrUpdateUser(idTokenResult.token)\n          .then((res) => {\n            dispatch({\n              type: \"LOGGED_IN_USER\",\n              payload: {\n                name: res.data.name,\n                email: res.data.email,\n                token: idTokenResult.token,\n                role: res.data.role,\n                _id: res.data._id,\n              },\n            });\n            roleBasedRedirect(res);\n          })\n          .catch((err) => console.log(err));\n        // history.push(\"/\");\n      })\n      .catch((err) => {\n        console.log(err);\n        toast.error(err.message);\n      });\n  };\n\n  const loginForm = () => (\n    <form onSubmit={handleSubmit}>\n      <div className=\"form-group\">\n        <input\n          type=\"email\"\n          className=\"form-control\"\n          value={email}\n          onChange={(e) => setEmail(e.target.value)}\n          placeholder=\"Your email\"\n          autoFocus\n        />\n      </div>\n\n      <div className=\"form-group\">\n        <input\n          type=\"password\"\n          className=\"form-control\"\n          value={password}\n          onChange={(e) => setPassword(e.target.value)}\n          placeholder=\"Your password\"\n        />\n      </div>\n\n      <br />\n      <Button\n        onClick={handleSubmit}\n        type=\"primary\"\n        className=\"mb-3\"\n        block\n        shape=\"round\"\n        icon={<MailOutlined />}\n        size=\"large\"\n        disabled={!email || password.length < 6}\n      >\n        Login with Email/Password\n      </Button>\n    </form>\n  );\n\n  return (\n    <div className=\"container p-5\">\n      <div className=\"row\">\n        <div className=\"col-md-6 offset-md-3\">\n          {loading ? (\n            <h4 className=\"text-danger\">Loading...</h4>\n          ) : (\n            <h4>Login</h4>\n          )}\n          {loginForm()}\n\n          <Button\n            onClick={googleLogin}\n            type=\"danger\"\n            className=\"mb-3\"\n            block\n            shape=\"round\"\n            icon={<GoogleOutlined />}\n            size=\"large\"\n          >\n            Login with Google\n          </Button>\n\n          <Link to=\"/forgot/password\" className=\"float-right text-danger\">\n            Forgot Password\n          </Link>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Login;\n"]},"metadata":{},"sourceType":"module"}